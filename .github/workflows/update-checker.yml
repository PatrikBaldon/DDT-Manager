name: Update Checker

on:
  schedule:
    - cron: '0 9 * * 1'  # Ogni lunedÃ¬ alle 9:00
  workflow_dispatch:

jobs:
  check-updates:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Check for updates
      run: |
        python -c "
        import requests
        import json
        
        # Controlla aggiornamenti dipendenze
        response = requests.get('https://pypi.org/pypi/django/json')
        django_latest = response.json()['info']['version']
        
        response = requests.get('https://pypi.org/pypi/reportlab/json')
        reportlab_latest = response.json()['info']['version']
        
        print(f'Django latest: {django_latest}')
        print(f'ReportLab latest: {reportlab_latest}')
        
        # Controlla aggiornamenti Python
        response = requests.get('https://api.github.com/repos/python/cpython/releases/latest')
        python_latest = response.json()['tag_name']
        
        print(f'Python latest: {python_latest}')
        "
    
    - name: Create issue if updates available
      if: failure()
      uses: actions/github-script@v6
      with:
        script: |
          const issue = await github.rest.issues.create({
            owner: 'PatrikBaldon',
            repo: 'DDT-Application',
            title: 'ðŸ”„ Aggiornamenti Dipendenze Disponibili',
            body: 'Sono disponibili aggiornamenti per le dipendenze del progetto. Controlla i log per dettagli.',
            labels: ['dependencies', 'maintenance']
          });
          
          console.log(`Issue created: ${issue.data.html_url}`);
